# Mesh V2 ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆãƒ¡ã‚«ãƒ‹ã‚ºãƒ å®Ÿè£… é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ

## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
- **Issue**: [smalruby/mesh-v2#14](https://github.com/smalruby/mesh-v2/issues/14)
- **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: [smalruby/mesh-v2#15](https://github.com/smalruby/mesh-v2/pull/15)
- **å®Ÿè£…**: å®Œäº†ï¼ˆAppSync Pipeline Resolver, CDK, Ruby Specsï¼‰
- **æ¤œè¨¼**: `stg2` ç’°å¢ƒã§ã® RSpecï¼ˆå…¨49ã‚±ãƒ¼ã‚¹ï¼‰ãƒ‘ã‚¹ã‚’ç¢ºèªæ¸ˆã¿

## å®Ÿæ–½ã—ãŸå¤‰æ›´å†…å®¹

### 1. GraphQL ã‚¹ã‚­ãƒ¼ãƒ (`graphql/schema.graphql`)
- `Group` å‹ã« `expiresAt: AWSDateTime!` ã‚’è¿½åŠ ã€‚
- `HeartbeatPayload` å‹ã‚’å®šç¾©ã€‚
- `Mutation.renewHeartbeat` ã‚’è¿½åŠ ï¼ˆãƒ›ã‚¹ãƒˆç”¨ï¼‰ã€‚

### 2. AppSync ãƒªã‚¾ãƒ«ãƒãƒ¼
- **`renewHeartbeat`**: å …ç‰¢æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒªã‚¾ãƒ«ãƒãƒ¼ã¨ã—ã¦å®Ÿè£…ã€‚
    - `checkGroupExists`: ã‚°ãƒ«ãƒ¼ãƒ—ã®å­˜åœ¨ã¨æ—¢å­˜ã®ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆç”Ÿå­˜ã‚’ç¢ºèªã€‚
    - `renewHeartbeatFunction`: ãƒ›ã‚¹ãƒˆèªè¨¼ã‚’è¡Œã„ã€`heartbeatAt` ã¨ `ttl` ã‚’æ›´æ–°ã€‚
- **`getGroup`**: æ–°è¦å®Ÿè£…ã€‚`expiresAt` ã‚’å«ã‚€ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã‚’å–å¾—å¯èƒ½ã«ã€‚
- **`listGroupsByDomain`**: ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆãŒé€”çµ¶ãˆãŸã‚°ãƒ«ãƒ¼ãƒ—ã‚’é™¤å¤–ã™ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã€‚
- **`createGroupIfNotExists`**: åˆæœŸ `expiresAt` (90åˆ†å¾Œ) ã¨ `ttl` (5åˆ†å¾Œ) ã‚’è¨­å®šã€‚

### 3. CDK ã‚¹ã‚¿ãƒƒã‚¯æ§‹æˆ (`lib/mesh-v2-stack.ts`)
- DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«ã§ `timeToLiveAttribute: 'ttl'` ã‚’æœ‰åŠ¹åŒ–ã€‚
- æ–°è¦ãƒªã‚¾ãƒ«ãƒãƒ¼ãŠã‚ˆã³ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°ã®ç™»éŒ²ã€‚

### 4. Ruby Specs (`spec/requests/`)
- `heartbeat_spec.rb`: ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆæ›´æ–°ã€ãƒ›ã‚¹ãƒˆèªè¨¼ã€`expiresAt` ã®å¯è¦–æ€§ã‚’ç¶²ç¾…ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã€‚
- æ—¢å­˜ã® GraphQL ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã‚’ `expiresAt` å¯¾å¿œã«æ›´æ–°ã€‚

### 5. JavaScript ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (`examples/javascript-client/`)
- `MeshClient`: `renewHeartbeat` ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ ã€‚
- `app.js`: ãƒ›ã‚¹ãƒˆã«ã‚ˆã‚‹è‡ªå‹•ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆæ›´æ–°ï¼ˆ1åˆ†æ¯ï¼‰ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºã®å®Ÿè£…ã€‚

## æ¤œè¨¼çµæœ
`stg2` ç’°å¢ƒã«ãŠã„ã¦ã€å…¨49ä»¶ã® RSpec ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

---
ãƒ¬ãƒãƒ¼ãƒˆæ›´æ–°æ—¥: 2025-12-27
ğŸ¤– Gemini CLI Progress Report
