# Mesh V2 ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆãƒ¡ã‚«ãƒ‹ã‚ºãƒ å®Ÿè£… é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ

## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
- **Issue**: [smalruby/mesh-v2#14](https://github.com/smalruby/mesh-v2/issues/14) ä½œæˆæ¸ˆã¿
- **å®Ÿè£…**: AppSync JS ãƒªã‚¾ãƒ«ãƒãƒ¼ã€CDK ã‚¹ã‚¿ãƒƒã‚¯ã€ãŠã‚ˆã³ JavaScript ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä¿®æ­£å®Œäº†
- **æ¤œè¨¼**: `npm run build` ãŠã‚ˆã³ `npx cdk synth` ã«ã‚ˆã‚‹æ¤œè¨¼å®Œäº†ã€‚ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã®ãƒ“ãƒ«ãƒ‰å®Œäº†ã€‚

## å®Ÿæ–½ã—ãŸå¤‰æ›´å†…å®¹

### 1. GraphQL ã‚¹ã‚­ãƒ¼ãƒ (`graphql/schema.graphql`)
- `Group` å‹ã« `expiresAt: AWSDateTime!` ã‚’è¿½åŠ ã€‚
- `HeartbeatPayload` å‹ã‚’å®šç¾©ã€‚
- `Mutation.renewHeartbeat` ã‚’è¿½åŠ ï¼ˆãƒ›ã‚¹ãƒˆç”¨ï¼‰ã€‚

### 2. ãƒªã‚¾ãƒ«ãƒãƒ¼ãƒ­ã‚¸ãƒƒã‚¯ (AppSync JS)
- `createGroup`: `expiresAt` (90åˆ†å¾Œ), `heartbeatAt` (ç¾åœ¨), `ttl` (5åˆ†å¾Œ) ã‚’è¨­å®šã€‚
- `renewHeartbeat`: ãƒ›ã‚¹ãƒˆèªè¨¼ã‚’è¡Œã„ã€`heartbeatAt` ã¨ `ttl` ã‚’æ›´æ–°ã€‚
- `listGroupsByDomain`: ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆãŒé€”çµ¶ãˆãŸã‚°ãƒ«ãƒ¼ãƒ—ã‚’é™¤å¤–ã€‚
- `checkGroupExists`: å…¨ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã‚’ç¢ºèªã€‚

### 3. CDK ã‚¹ã‚¿ãƒƒã‚¯æ§‹æˆ (`lib/mesh-v2-stack.ts`)
- DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«ã§ `timeToLiveAttribute: 'ttl'` ã‚’è¨­å®šã€‚
- `renewHeartbeat` ãƒªã‚¾ãƒ«ãƒãƒ¼ã‚’ç™»éŒ²ã€‚

### 4. JavaScript ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (`examples/javascript-client/`)
- `MeshClient`: `renewHeartbeat` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã€‚æ—¢å­˜ã‚¯ã‚¨ãƒªã« `expiresAt` ã‚’è¿½åŠ ã€‚
- `app.js`:
    - ãƒ›ã‚¹ãƒˆã«ã‚ˆã‚‹å®šæœŸçš„ãªãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆé€ä¿¡ï¼ˆ1åˆ†æ¯ï¼‰ã‚’å®Ÿè£…ã€‚
    - ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã® `expiresAt` ã«åŸºã¥ãã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºã€‚
    - ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§ã§ã®æœ‰åŠ¹æœŸé™è¡¨ç¤ºã€‚
- ãƒ“ãƒ«ãƒ‰: `npm run build` ã«ã‚ˆã‚Š `mesh-client.bundle.js` ã‚’æ›´æ–°ã€‚

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ãƒ‡ãƒ—ãƒ­ã‚¤**:
   ```bash
   npx cdk deploy --context stage=stg
   ```
2. **smalruby3-gui ã¸ã®çµ±åˆ**:
   - `scratch-vm` ã¾ãŸã¯ `smalruby3-gui` ã®é€šä¿¡ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«åŒæ§˜ã®ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ„ã¿è¾¼ã‚€ã€‚

---
ãƒ¬ãƒãƒ¼ãƒˆæ›´æ–°æ—¥: 2025-12-26
ğŸ¤– Gemini CLI Progress Report
